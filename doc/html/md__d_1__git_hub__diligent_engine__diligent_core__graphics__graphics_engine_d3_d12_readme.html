<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Diligent Engine API Reference: GraphicsEngineD3D12</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Diligent Engine API Reference
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">GraphicsEngineD3D12 </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Implementation of <a class="el" href="namespace_diligent.html" title="Namespace for the OpenGL implementation of the graphics engine. ">Diligent</a> Engine API using Direct3D12</p>
<h1>Initialization</h1>
<p>The following code snippet shows how to initialize diligent engine in D3D12 mode.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;RenderDeviceFactoryD3D12.h&quot;</span></div><div class="line"><span class="keyword">using namespace </span><a class="code" href="namespace_diligent.html">Diligent</a>;</div><div class="line"></div><div class="line"><span class="comment">// ... </span></div><div class="line"><span class="preprocessor">#ifdef ENGINE_DLL</span></div><div class="line">    GetEngineFactoryD3D12Type GetEngineFactoryD3D12 = <span class="keyword">nullptr</span>;</div><div class="line">    <span class="comment">// Load the dll and import GetEngineFactoryD3D12() function</span></div><div class="line">    <a class="code" href="namespace_diligent.html#a8b3ac65ac7e5051a36f23aab198b7f26">LoadGraphicsEngineD3D12</a>(GetEngineFactoryD3D12);</div><div class="line"><span class="preprocessor">#endif</span></div><div class="line"><span class="keyword">auto</span> *pFactoryD3D11 = GetEngineFactoryD3D12();</div><div class="line"><a class="code" href="struct_diligent_1_1_engine_d3_d12_attribs.html">EngineD3D12Attribs</a> EngD3D12Attribs;</div><div class="line">EngD3D12Attribs.<a class="code" href="struct_diligent_1_1_engine_d3_d12_attribs.html#a12fe830b453e67b806300b7082aaa485">CPUDescriptorHeapAllocationSize</a>[0] = 1024;</div><div class="line">EngD3D12Attribs.<a class="code" href="struct_diligent_1_1_engine_d3_d12_attribs.html#a12fe830b453e67b806300b7082aaa485">CPUDescriptorHeapAllocationSize</a>[1] = 32;</div><div class="line">EngD3D12Attribs.<a class="code" href="struct_diligent_1_1_engine_d3_d12_attribs.html#a12fe830b453e67b806300b7082aaa485">CPUDescriptorHeapAllocationSize</a>[2] = 16;</div><div class="line">EngD3D12Attribs.<a class="code" href="struct_diligent_1_1_engine_d3_d12_attribs.html#a12fe830b453e67b806300b7082aaa485">CPUDescriptorHeapAllocationSize</a>[3] = 16;</div><div class="line">EngD3D12Attribs.<a class="code" href="struct_diligent_1_1_engine_d3_d12_attribs.html#a71eeaab09ee38f40ae159f7e8ecc801b">NumCommandsToFlushCmdList</a> = 64;</div><div class="line"><a class="code" href="class_diligent_1_1_ref_cnt_auto_ptr.html">RefCntAutoPtr&lt;IRenderDevice&gt;</a> pRenderDevice;</div><div class="line"><a class="code" href="class_diligent_1_1_ref_cnt_auto_ptr.html">RefCntAutoPtr&lt;IDeviceContext&gt;</a> pImmediateContext;</div><div class="line"><a class="code" href="struct_diligent_1_1_swap_chain_desc.html">SwapChainDesc</a> <a class="code" href="struct_diligent_1_1_swap_chain_desc.html">SwapChainDesc</a>;</div><div class="line"><a class="code" href="class_diligent_1_1_ref_cnt_auto_ptr.html">RefCntAutoPtr&lt;ISwapChain&gt;</a> pSwapChain;</div><div class="line">pFactoryD3D11-&gt;CreateDeviceAndContextsD3D12( EngD3D12Attribs, &amp;pRenderDevice, &amp;pImmediateContext, 0 );</div><div class="line">pFactoryD3D11-&gt;CreateSwapChainD3D12( pRenderDevice, pImmediateContext, <a class="code" href="struct_diligent_1_1_swap_chain_desc.html">SwapChainDesc</a>, hWnd, &amp;pSwapChain );</div></div><!-- fragment --><p>Alternatively, the engine can be initialized by attaching to existing D3D12 device (see below).</p>
<h1>Interoperability with Direct3D12</h1>
<p><a class="el" href="namespace_diligent.html" title="Namespace for the OpenGL implementation of the graphics engine. ">Diligent</a> Engine exposes methods to access internal D3D12 objects, is able to create diligent engine buffers and textures from existing Direct3D12 resources, and can be initialized by attaching to existing D3D12 device and provide synchronization tools.</p>
<h2>Accessing Native D3D12 Resources</h2>
<p>Below are some of the methods that provide access to internal D3D12 objects:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Function  </th><th class="markdownTableHeadNone">Description   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>ID3D12Resource* IBufferD3D12::GetD3D12Buffer(size_t &amp;DataStartByteOffset, Uint32 ContextId)</code>  </td><td class="markdownTableBodyNone">returns a pointer to the ID3D12Resource interface of the internal Direct3D12 buffer object. Note that dynamic buffers are suballocated from dynamic heap, and every context has its own dynamic heap. Offset from the beginning of the dynamic heap for a context identified by ContextId is returned in DataStartByteOffset parameter   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>void IBufferD3D12::SetD3D12ResourceState(D3D12_RESOURCE_STATES state)</code>  </td><td class="markdownTableBodyNone">sets the buffer usage state. This method should be used when an application transitions the buffer to inform diligent engine about the current usage state   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>D3D12_CPU_DESCRIPTOR_HANDLE IBufferViewD3D12::GetCPUDescriptorHandle()</code>  </td><td class="markdownTableBodyNone">returns CPU descriptor handle of the buffer view   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>ID3D12Resource* ITextureD3D12::GetD3D12Texture()</code>  </td><td class="markdownTableBodyNone">returns a pointer to the ID3D12Resource interface of the internal Direct3D12 texture object   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>void ITextureD3D12::SetD3D12ResourceState(D3D12_RESOURCE_STATES state)</code>  </td><td class="markdownTableBodyNone">sets the texture usage state. This method should be used when an application transitions the texture to inform diligent engine about the current usage state   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>D3D12_CPU_DESCRIPTOR_HANDLE ITextureViewD3D12::GetCPUDescriptorHandle()</code>  </td><td class="markdownTableBodyNone">returns CPU descriptor handle of the texture view   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>void IDeviceContextD3D12::TransitionTextureState(ITexture *pTexture, D3D12_RESOURCE_STATES State)</code>  </td><td class="markdownTableBodyNone">transitions internal D3D12 texture object to a specified state   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>void IDeviceContextD3D12::TransitionBufferState(IBuffer *pBuffer, D3D12_RESOURCE_STATES State)</code>  </td><td class="markdownTableBodyNone">transitions internal D3D12 buffer object to a specified state   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>ID3D12PipelineState* IPipelineStateD3D12::GetD3D12PipelineState()</code>  </td><td class="markdownTableBodyNone">returns ID3D12PipelineState interface of the internal D3D12 pipeline state object object   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>ID3D12RootSignature* IPipelineStateD3D12::GetD3D12RootSignature()</code>  </td><td class="markdownTableBodyNone">returns a pointer to the root signature object associated with this pipeline state   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>D3D12_CPU_DESCRIPTOR_HANDLE ISamplerD3D12::GetCPUDescriptorHandle()</code>  </td><td class="markdownTableBodyNone">returns a CPU descriptor handle of the D3D12 sampler object   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>ID3D12Device* IRenderDeviceD3D12::GetD3D12Device()</code>  </td><td class="markdownTableBodyNone">returns ID3D12Device interface of the internal Direct3D12 device object   </td></tr>
</table>
<h2>Synchronization Tools</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Function  </th><th class="markdownTableHeadNone">Description   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>Uint64 IRenderDeviceD3D12::GetNextFenceValue()</code>  </td><td class="markdownTableBodyNone">returns the fence value that will be signaled by the GPU command queue when the next command list is submitted for execution   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>Bool IRenderDeviceD3D12::IsFenceSignaled(Uint64 FenceValue)</code>  </td><td class="markdownTableBodyNone">checks if the fence value has been signaled by the GPU. True means that all associated work has been finished   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>void IRenderDeviceD3D12::FinishFrame()</code>  </td><td class="markdownTableBodyNone">this method should be called at the end of the frame when attached to existing D3D12 device. Otherwise the method is automatically called before present   </td></tr>
</table>
<h2>Creating <a class="el" href="namespace_diligent.html" title="Namespace for the OpenGL implementation of the graphics engine. ">Diligent</a> Engine Objects from D3D12 Resources</h2>
<ul>
<li><code>void IRenderDeviceD3D12::CreateTextureFromD3DResource(ID3D12Resource *pd3d12Texture, ITexture **ppTexture)</code> - creates a diligent engine texture object from native D3D12 resource.</li>
<li><code>void IRenderDeviceD3D12::CreateBufferFromD3DResource(ID3D12Resource *pd3d12Buffer, const BufferDesc&amp; BuffDesc, IBuffer **ppBuffer)</code> - creates a diligent engine buffer object from native D3D12 resource. The method takes a pointer to the native d3d12 resiyrce pd3d12Buffer, buffer description BuffDesc and writes a pointer to the IBuffer interface at the memory location pointed to by ppBuffer. The system can recover buffer size, but the rest of the fields of BuffDesc structure need to be populated by the client as they cannot be recovered from d3d12 resource description.</li>
</ul>
<h2>Initializing the Engine by Attaching to Existing D3D12 Device</h2>
<p>To attach diligent engine to existing D3D12 device, use the following factory function:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> IEngineFactoryD3D12::AttachToD3D12Device(<span class="keywordtype">void</span> *pd3d12NativeDevice,</div><div class="line">                                              <span class="keyword">class</span> ICommandQueueD3D12 *pCommandQueue,</div><div class="line">                                              <span class="keyword">const</span> EngineD3D12Attribs&amp; EngineAttribs,</div><div class="line">                                              IRenderDevice **ppDevice,</div><div class="line">                                              IDeviceContext **ppContexts,</div><div class="line">                                              Uint32 NumDeferredContexts);</div></div><!-- fragment --><p>The method takes a pointer to the native D3D12 device <code>pd3d12NativeDevice</code>, initialization parameters <code>EngineAttribs</code>, and returns diligent engine device interface in <code>ppDevice</code>, and diligent engine contexts in <code>ppContexts</code>. Pointer to the immediate goes at position 0. If <code>NumDeferredContexts</code> &gt; 0, pointers to deferred contexts go afterwards. The function also takes a pointer to the command queue object <code>pCommandQueue</code>, which needs to implement <code>ICommandQueueD3D12</code> interface.</p>
<p>For more information about interoperability with D3D12, please visit <a href="http://diligentgraphics.com/diligent-engine/native-api-interoperability/direct3d12-interoperability/">Diligent Engine web site</a></p>
<h1>References</h1>
<p><a href="http://diligentgraphics.com/diligent-engine">Diligent Engine</a></p>
<p><a href="http://diligentgraphics.com/diligent-engine/native-api-interoperability/direct3d12-interoperability/">Interoperability with Direct3D12</a></p>
<p><a href="http://diligentgraphics.com/diligent-engine/architecture/D3D12">Architecture of D3D12-based implementation</a></p>
<h1>Release Notes</h1>
<h2>2.1</h2>
<h3>New fatures</h3>
<ul>
<li>Interoperability with Direct3D12 ** Accessing internal D3D12 objects and handles ** Createing diligent engine buffers/textures from D3D12 resources ** Attaching to existing D3D12 device ** Resource state and command queue synchronization</li>
<li>Integraion with Unity</li>
<li>Geometry shader support</li>
<li>Tessellation support</li>
<li>Support for dynamic buffers with SRV/UAV bind flags</li>
<li>Support for structured buffers in HSLS shaders</li>
<li>Performance optimizations</li>
</ul>
<h3>API Changes</h3>
<ul>
<li>Updated map interface: removed MAP_WRITE_DISCARD and MAP_WRITE_NO_OVERWRITE map types and added MAP_FLAG_DISCARD and MAP_FLAG_DO_NOT_SYNCHRONIZE flags instead</li>
</ul>
<h3>Bug fixes</h3>
<ul>
<li>Issues with deferred contexts<ul>
<li>Never flush deferred D3D12 context</li>
<li>Invalidate context state from FinishCommandList() and ExecuteCommandList()</li>
<li>Not binding default RTV &amp; DSV for deferred contexts</li>
</ul>
</li>
<li>Issues with idling GPU</li>
<li>Object relase bug: when releasing last reference to a device object, render device was destroyed before the object was fully released</li>
<li>Fixed mipmap generation for SRGB textures</li>
<li>Fixed mipmap generation for texture arrays</li>
</ul>
<h2>2.0</h2>
<p>Reworked the API to follow D3D12 style</p>
<h2>1.0</h2>
<p>Initial release</p>
<p><b>Copyright 2015-2017 Egor Yusov</b></p>
<p><a href="http://diligentgraphics.com">Diligent Graphics</a> </p>
</div></div><!-- contents -->
<!-- HTML footer for doxygen 1.8.10-->
<!-- start footer part -->
<!--
<hr class="footer"/><address class="footer"><small>
Generated on Wed Jan 3 2018 20:17:25 for Diligent Engine API Reference by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.14
</small></address>
-->
</body>
</html>
