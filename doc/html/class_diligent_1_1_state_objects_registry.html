<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Diligent Engine API Reference: Diligent::StateObjectsRegistry&lt; ResourceDescType &gt; Class Template Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Diligent Engine API Reference
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="namespace_diligent.html">Diligent</a></li><li class="navelem"><a class="el" href="class_diligent_1_1_state_objects_registry.html">StateObjectsRegistry</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pub-static-attribs">Static Public Attributes</a> &#124;
<a href="class_diligent_1_1_state_objects_registry-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">Diligent::StateObjectsRegistry&lt; ResourceDescType &gt; Class Template Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Template class implementing state object registry.  
 <a href="class_diligent_1_1_state_objects_registry.html#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a24b0050a49d3cb95c7da0540648f4d28"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_diligent_1_1_state_objects_registry.html#a24b0050a49d3cb95c7da0540648f4d28">Add</a> (const ResourceDescType &amp;ObjectDesc, <a class="el" href="class_diligent_1_1_i_device_object.html">IDeviceObject</a> *pObject)</td></tr>
<tr class="memdesc:a24b0050a49d3cb95c7da0540648f4d28"><td class="mdescLeft">&#160;</td><td class="mdescRight">Adds a new object to the registry.  <a href="#a24b0050a49d3cb95c7da0540648f4d28">More...</a><br /></td></tr>
<tr class="separator:a24b0050a49d3cb95c7da0540648f4d28"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6643d764bfcb0bc4314a4d4f227dc4a2"><td class="memItemLeft" align="right" valign="top"><a id="a6643d764bfcb0bc4314a4d4f227dc4a2"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_diligent_1_1_state_objects_registry.html#a6643d764bfcb0bc4314a4d4f227dc4a2">Find</a> (const ResourceDescType &amp;Desc, <a class="el" href="class_diligent_1_1_i_device_object.html">IDeviceObject</a> **ppObject)</td></tr>
<tr class="memdesc:a6643d764bfcb0bc4314a4d4f227dc4a2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Finds the object in the registry. <br /></td></tr>
<tr class="separator:a6643d764bfcb0bc4314a4d4f227dc4a2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac4e68d1e015e2ad5941700b4d595a71a"><td class="memItemLeft" align="right" valign="top"><a id="ac4e68d1e015e2ad5941700b4d595a71a"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_diligent_1_1_state_objects_registry.html#ac4e68d1e015e2ad5941700b4d595a71a">Purge</a> ()</td></tr>
<tr class="memdesc:ac4e68d1e015e2ad5941700b4d595a71a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Purges outstanding deleted objects from the registry. <br /></td></tr>
<tr class="separator:ac4e68d1e015e2ad5941700b4d595a71a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a65e4d7c1d3e3f1e6519979b7eac0498c"><td class="memItemLeft" align="right" valign="top"><a id="a65e4d7c1d3e3f1e6519979b7eac0498c"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_diligent_1_1_state_objects_registry.html#a65e4d7c1d3e3f1e6519979b7eac0498c">ReportDeletedObject</a> ()</td></tr>
<tr class="memdesc:a65e4d7c1d3e3f1e6519979b7eac0498c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Increments the number of outstanding deleted objects. When this number reaches DeletedObjectsToPurge, <a class="el" href="class_diligent_1_1_state_objects_registry.html#ac4e68d1e015e2ad5941700b4d595a71a" title="Purges outstanding deleted objects from the registry. ">Purge()</a> will be called. <br /></td></tr>
<tr class="separator:a65e4d7c1d3e3f1e6519979b7eac0498c"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-static-attribs"></a>
Static Public Attributes</h2></td></tr>
<tr class="memitem:ae826dc2c8950c7f40d3fe37dfc1d36b7"><td class="memItemLeft" align="right" valign="top"><a id="ae826dc2c8950c7f40d3fe37dfc1d36b7"></a>
static constexpr int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_diligent_1_1_state_objects_registry.html#ae826dc2c8950c7f40d3fe37dfc1d36b7">DeletedObjectsToPurge</a> = 32</td></tr>
<tr class="memdesc:ae826dc2c8950c7f40d3fe37dfc1d36b7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Number of outstanding deleted objects to purge the registry. <br /></td></tr>
<tr class="separator:ae826dc2c8950c7f40d3fe37dfc1d36b7"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><h3>template&lt;typename ResourceDescType&gt;<br />
class Diligent::StateObjectsRegistry&lt; ResourceDescType &gt;</h3>

<p>Template class implementing state object registry. </p>
<dl class="tparams"><dt>Template Parameters</dt><dd>
  <table class="tparams">
    <tr><td class="paramname">ResourceDescType</td><td>- type of the resource description. The type must have operator== and a hash function defined.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section remark"><dt>Remarks</dt><dd>The following strategies do not work:<ul>
<li>To store raw pointers and remove the object from the registry in the object's destructor. In this case other thread may obtain a reference to the object while it is being deleted. This scenario is possible if one thread has just entered the destructor, but other is executing <a class="el" href="class_diligent_1_1_state_objects_registry.html#a6643d764bfcb0bc4314a4d4f227dc4a2" title="Finds the object in the registry. ">Find()</a> and entered the protection section.</li>
<li>Strong pointers will cause circular references and result in memory leaks. </li>
</ul>
</dd>
<dd>
Only weak pointers provide thread-safe solution. The object is either atomically destroyed, so that no other thread can obtain a reference to it through weak pointers. Or it is atomically locked, so that strong reference is obtained. In this case no other thread can destroy the object, because there is at least one strong reference now. Note however that removing the object from the registry in the object's destructor may cause a deadlock at the point where <a class="el" href="class_diligent_1_1_state_objects_registry.html#a6643d764bfcb0bc4314a4d4f227dc4a2" title="Finds the object in the registry. ">Find()</a> locks the weak pointer: if other thread has started dtor, the object will be locked by Diligent::RefCountedObject::Release(). If after that this thread locks the registry first, it will be waiting for the object to unlock in <a class="el" href="class_diligent_1_1_ref_cnt_weak_ptr.html#a39b29df7165190c63a48261e9fa2cd14" title="Obtains a strong reference to the object. ">Diligent::RefCntWeakPtr::Lock()</a>, while the dtor thread will be waiting for the registry to unlock. </dd></dl>
</div><h2 class="groupheader">Member Function Documentation</h2>
<a id="a24b0050a49d3cb95c7da0540648f4d28"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a24b0050a49d3cb95c7da0540648f4d28">&#9670;&nbsp;</a></span>Add()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename ResourceDescType&gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="class_diligent_1_1_state_objects_registry.html">Diligent::StateObjectsRegistry</a>&lt; ResourceDescType &gt;::Add </td>
          <td>(</td>
          <td class="paramtype">const ResourceDescType &amp;&#160;</td>
          <td class="paramname"><em>ObjectDesc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_diligent_1_1_i_device_object.html">IDeviceObject</a> *&#160;</td>
          <td class="paramname"><em>pObject</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Adds a new object to the registry. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">ObjectDesc</td><td>- object description. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">pObject</td><td>- pointer to the object.</td></tr>
  </table>
  </dd>
</dl>
<p>Besides adding a new object, the function also checks the number of outstanding deleted objects and calls <a class="el" href="class_diligent_1_1_state_objects_registry.html#ac4e68d1e015e2ad5941700b4d595a71a" title="Purges outstanding deleted objects from the registry. ">Purge()</a> if the number has reached the threshold value DeletedObjectsToPurge. Creating a state object is assumed to be an expensive operation and should be performed during the initialization. Occasional purge operations should not add significant cost to it. </p>

</div>
</div>
</div><!-- contents -->
<!-- HTML footer for doxygen 1.8.10-->
<!-- start footer part -->
<!--
<hr class="footer"/><address class="footer"><small>
Generated on Wed Jan 3 2018 22:00:33 for Diligent Engine API Reference by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.14
</small></address>
-->
</body>
</html>
